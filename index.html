<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ù„Ù ÙˆØ§Ø±Ø¨Ø­ ğŸ</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#111c3a;
    --text:#ffffff;
    --muted:#cbd5e1;
    --accent:#22c55e;
    --accent2:#6366f1;
    --danger:#ef4444;
    --gold:#facc15;
  }
  body{
    margin:0;
    font-family: Tahoma, Arial, sans-serif;
    background: radial-gradient(900px 600px at 70% 0%, #1b2a6b 0%, transparent 60%),
                radial-gradient(900px 600px at 10% 20%, #4c1d95 0%, transparent 55%),
                var(--bg);
    color:var(--text);
    text-align:center;
    padding:18px;
  }
  h1{margin:14px 0 6px; font-size:28px}
  #countdown{font-size:20px; margin-top:8px; color:var(--gold)}
  .wrap{max-width:980px; margin:0 auto}
  .wheelWrap{
    margin:16px auto 10px;
    width:min(520px, 95vw);
    padding:14px;
    background: rgba(17,28,58,.7);
    border:1px solid rgba(255,255,255,.10);
    border-radius:18px;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
    position:relative;
  }
  canvas{
    width:min(480px, 92vw);
    height:min(480px, 92vw);
    border-radius:50%;
    background: rgba(255,255,255,.04);
    display:block;
    margin:0 auto;
  }
  .pointer{
    position:absolute;
    top:4px;
    left:50%;
    transform:translateX(-50%);
    width:0;height:0;
    border-left:18px solid transparent;
    border-right:18px solid transparent;
    border-bottom:34px solid var(--danger);
    filter: drop-shadow(0 8px 12px rgba(0,0,0,.4));
  }
  .pointer::after{
    content:"";
    position:absolute;
    left:-8px; top:10px;
    width:16px; height:16px;
    background:#fff;
    border-radius:50%;
    box-shadow:0 8px 20px rgba(0,0,0,.35);
  }
  .btns{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:12px 0 6px}
  button{
    padding:14px 22px;
    font-size:18px;
    border:0;
    border-radius:12px;
    cursor:pointer;
    font-weight:800;
  }
  .spinBtn{background: linear-gradient(135deg, #22c55e, #16a34a); color:#05210f; min-width:180px}
  .ghostBtn{background: rgba(255,255,255,.08); color:var(--text); border:1px solid rgba(255,255,255,.14)}
  .note{font-size:13px; color:var(--muted); margin-top:8px; line-height:1.7}
  .list{
    max-width:520px;
    margin:14px auto 0;
    background: rgba(17,28,58,.55);
    border:1px solid rgba(255,255,255,.10);
    border-radius:18px;
    padding:12px;
    text-align:right;
  }
  .item{
    display:flex; gap:12px; align-items:center;
    padding:10px 10px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
    margin:8px 0;
  }
  .item img{width:46px; height:46px; object-fit:cover; border-radius:12px; background:rgba(255,255,255,.08)}
  .item b{display:block}
  .item small{color:var(--muted)}
  /* Modal */
  .modal{
    position:fixed; inset:0;
    background:rgba(0,0,0,.65);
    display:none;
    align-items:center;
    justify-content:center;
    padding:16px;
    z-index:50;
  }
  .modal.show{display:flex}
  .modal .box{
    width:min(520px, 100%);
    background: rgba(17,28,58,.96);
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    padding:18px;
    box-shadow: 0 24px 70px rgba(0,0,0,.55);
  }
  .winImg{
    width:120px;height:120px;
    border-radius:22px;
    object-fit:cover;
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12);
    margin:10px auto 6px;
    display:none;
  }
  .modal h2{margin:8px 0 8px}
  .modal p{margin:0 0 12px; color:var(--muted); line-height:1.7}
  .claimRow{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px}
  .claimBtn{
    display:inline-block;
    padding:13px 18px;
    border-radius:12px;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color:#05210f;
    text-decoration:none;
    font-weight:900;
    min-width: 190px;
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Ù„Ù Ø§Ù„Ø¹Ø¬Ù„Ø© ÙˆØ§Ø±Ø¨Ø­ ğŸ</h1>
  <div id="countdown"></div>

  <div class="wheelWrap">
    <div class="pointer" aria-hidden="true"></div>
    <canvas id="wheel" width="900" height="900"></canvas>

    <div class="btns">
      <button class="spinBtn" id="spinBtn">Ù„Ù Ø§Ù„Ø¢Ù†</button>
      <button class="ghostBtn" id="resetBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>

    <div class="note">
      Ø¶Ø¹ ØµÙˆØ± Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙÙŠ ÙÙˆÙ„Ø¯Ø± <b>assets</b> Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.
    </div>
  </div>

  <div class="list" id="prizeList"></div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="box">
    <img id="winImg" class="winImg" alt="Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©" />
    <h2 id="winTitle">Ù…Ø¨Ø±ÙˆÙƒ!</h2>
    <p id="winText"></p>

    <div class="claimRow">
      <a id="claimBtn" class="claimBtn" target="_blank" rel="noopener">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ©</a>
      <button class="ghostBtn" id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<script>
  // âœ… Ù„ÙŠÙ†Ùƒ Ø§Ù„Ù€ CPA (Ù…Ø±ÙƒÙ‘Ø¨)
  const CPA_URL = "https://adsmain.bountyads.store/?utm_medium=24c9e8ead1a61abc4ca11515604da84dbebe69ba&utm_campaign=spent";

  // âœ… Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²: 4 ØµÙˆØ± + "Ø­Ø¸ Ø£ÙˆÙØ±" Ù…Ø±ØªÙŠÙ†
  const prizes = [
    { label: "Samsung Galaxy S24 Ultra", img: "assets/galaxys24ultra-png.png" },
    { label: "Apple Watch Series 9",      img: "assets/apple-watch-series-9-png.png" },
    { label: "iPhone 15 Pro Max",         img: "assets/apple-iphone-15-pro-max-natural-titanium-png.png" },
    { label: "AirPods Pro (2nd Gen)",     img: "assets/airpods-pro-2nd-generation-png.png" },
    { label: "Ø­Ø¸ Ø£ÙˆÙØ±",                   img: null },
    { label: "Ø­Ø¸ Ø£ÙˆÙØ±",                   img: null },
  ];

  const sliceColors = [
    "rgba(99,102,241,.82)",
    "rgba(139,92,246,.78)",
    "rgba(34,197,94,.70)",
    "rgba(245,158,11,.72)",
    "rgba(236,72,153,.68)",
    "rgba(59,130,246,.70)"
  ];

  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");

  const spinBtn = document.getElementById("spinBtn");
  const resetBtn = document.getElementById("resetBtn");

  const modal = document.getElementById("modal");
  const closeBtn = document.getElementById("closeBtn");
  const winImg = document.getElementById("winImg");
  const winTitle = document.getElementById("winTitle");
  const winText = document.getElementById("winText");
  const claimBtn = document.getElementById("claimBtn");

  const prizeList = document.getElementById("prizeList");

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
  const loadedImages = new Map();
  function loadImage(src){
    return new Promise((resolve) => {
      if(!src) return resolve(null);
      if(loadedImages.has(src)) return resolve(loadedImages.get(src));
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => { loadedImages.set(src, img); resolve(img); };
      img.onerror = () => resolve(null);
      img.src = src;
    });
  }

  // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø©
  let currentRotation = 0; // radians

  function roundRect(ctx, x, y, w, h, r){
    const rr = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+rr, y);
    ctx.arcTo(x+w, y, x+w, y+h, rr);
    ctx.arcTo(x+w, y+h, x, y+h, rr);
    ctx.arcTo(x, y+h, x, y, rr);
    ctx.arcTo(x, y, x+w, y, rr);
    ctx.closePath();
  }

  function truncate(s, n){
    return s.length > n ? s.slice(0, n-1) + "â€¦" : s;
  }

  function drawWheel(){
    const w = canvas.width, h = canvas.height;
    ctx.clearRect(0,0,w,h);

    const cx = w/2, cy = h/2;
    const R = Math.min(w,h)*0.46;
    const slices = prizes.length;
    const sliceAngle = (Math.PI*2)/slices;

    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(currentRotation);

    for(let i=0;i<slices;i++){
      const start = i*sliceAngle;
      const end = start + sliceAngle;

      // sector
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,R,start,end);
      ctx.closePath();

      ctx.fillStyle = sliceColors[i % sliceColors.length];
      ctx.fill();

      ctx.strokeStyle = "rgba(255,255,255,.18)";
      ctx.lineWidth = 6;
      ctx.stroke();

      // middle angle
      const mid = start + sliceAngle/2;

      // draw image or "Ø­Ø¸ Ø£ÙˆÙØ±"
      const img = prizes[i].img ? (loadedImages.get(prizes[i].img) || null) : null;
      const imgR = R*0.18;
      const imgX = Math.cos(mid) * (R*0.62);
      const imgY = Math.sin(mid) * (R*0.62);

      if(img){
        ctx.save();
        ctx.translate(imgX, imgY);
        // Ø§Ø¬Ø¹Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø³ØªÙ‚ÙŠÙ…Ø© Ù„Ù„Ø¹Ø±Ø¶
        ctx.rotate(-currentRotation - mid + Math.PI/2);

        roundRect(ctx, -imgR-10, -imgR-10, (imgR+10)*2, (imgR+10)*2, 18);
        ctx.fillStyle = "rgba(0,0,0,.22)";
        ctx.fill();

        ctx.drawImage(img, -imgR, -imgR, imgR*2, imgR*2);
        ctx.restore();
      } else {
        ctx.save();
        ctx.translate(imgX, imgY);
        ctx.rotate(-currentRotation - mid + Math.PI/2);

        ctx.fillStyle = "rgba(0,0,0,.22)";
        roundRect(ctx, -imgR-10, -imgR-10, (imgR+10)*2, (imgR+10)*2, 18);
        ctx.fill();

        ctx.fillStyle = "rgba(255,255,255,.92)";
        ctx.font = "900 28px Tahoma, Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("Ø­Ø¸ Ø£ÙˆÙØ±", 0, 0);

        ctx.restore();
      }

      // label text
      const textX = Math.cos(mid) * (R*0.80);
      const textY = Math.sin(mid) * (R*0.80);

      ctx.save();
      ctx.translate(textX, textY);
      ctx.rotate(-currentRotation - mid + Math.PI/2);

      ctx.fillStyle = "rgba(255,255,255,.95)";
      ctx.font = "800 22px Tahoma, Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(truncate(prizes[i].label, 16), 0, 0);

      ctx.restore();
    }

    // center
    ctx.save();
    ctx.rotate(-currentRotation);
    ctx.beginPath();
    ctx.arc(0,0,R*0.14,0,Math.PI*2);
    ctx.fillStyle = "rgba(255,255,255,.92)";
    ctx.fill();
    ctx.restore();

    ctx.restore();
  }

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ§Ø¦Ø² Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø¤Ø´Ø± (Ø£Ø¹Ù„Ù‰)
  function getWinnerIndex(finalRotation){
    const slices = prizes.length;
    const sliceAngle = (Math.PI*2)/slices;
    const pointerAngle = -Math.PI/2;

    let ang = (pointerAngle - finalRotation) % (Math.PI*2);
    if(ang < 0) ang += Math.PI*2;

    return Math.floor(ang / sliceAngle);
  }

  // Ø³Ø¨ÙŠÙ†
  let spinning = false;
  function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

  function spin(){
    if(spinning) return;
    spinning = true;
    spinBtn.disabled = true;

    const extraTurns = 6 + Math.random()*4;
    const randomOffset = Math.random() * Math.PI*2;
    const start = currentRotation;
    const target = start + extraTurns * Math.PI*2 + randomOffset;

    const duration = 5200 + Math.random()*900;
    const t0 = performance.now();

    function frame(now){
      const t = Math.min(1, (now - t0) / duration);
      const e = easeOutCubic(t);
      currentRotation = start + (target - start) * e;
      drawWheel();

      if(t < 1){
        requestAnimationFrame(frame);
      } else {
        currentRotation = target % (Math.PI*2);
        drawWheel();
        const winIdx = getWinnerIndex(currentRotation);
        showWin(winIdx);
        spinning = false;
        spinBtn.disabled = false;
      }
    }
    requestAnimationFrame(frame);
  }

  function showWin(i){
    const p = prizes[i];

    winTitle.textContent = (p.label === "Ø­Ø¸ Ø£ÙˆÙØ±") ? "Ø­Ø¸ Ø£ÙˆÙØ± ğŸ˜…" : "Ù…Ø¨Ø±ÙˆÙƒ! ğŸ‰";
    winText.textContent = (p.label === "Ø­Ø¸ Ø£ÙˆÙØ±")
      ? "Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ! ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø¬Ø§ÙŠØ© ØªÙƒØ³Ø¨ ğŸ"
      : `ÙØ²Øª Ø¨Ù€: ${p.label} â€” Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ©.`;

    // Ø²Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
    claimBtn.href = CPA_URL;

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØµÙˆØ±Ø© Ø§Ù„ÙÙˆØ²
    if(p.img){
      winImg.src = p.img;
      winImg.alt = p.label;
      winImg.style.display = "block";
    } else {
      winImg.style.display = "none";
    }

    modal.classList.add("show");

    // âœ… ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù€ CPA ÙÙ‚Ø· Ù„Ùˆ Ù…Ø´ "Ø­Ø¸ Ø£ÙˆÙØ±"
    if(p.label !== "Ø­Ø¸ Ø£ÙˆÙØ±"){
      setTimeout(() => {
        window.location.href = CPA_URL;
      }, 1500);
    }
  }

  function closeModal(){
    modal.classList.remove("show");
  }

  function reset(){
    if(spinning) return;
    currentRotation = 0;
    drawWheel();
  }

  // Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ©
  function renderPrizeList(){
    prizeList.innerHTML = `
      <div style="font-weight:900; margin:6px 6px 10px; color:#fff;">Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ø¬Ù„Ø©</div>
    `;
    prizes.forEach(p=>{
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `
        ${p.img ? `<img src="${p.img}" alt="${p.label}" onerror="this.style.display='none'">` : `<img alt="" style="opacity:.35" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48'%3E%3Ctext x='50%25' y='55%25' dominant-baseline='middle' text-anchor='middle' font-size='22'%3E%F0%9F%8E%81%3C/text%3E%3C/svg%3E">`}
        <div>
          <b>${p.label}</b>
          <small>${p.img ? p.img : "Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©"}</small>
        </div>
      `;
      prizeList.appendChild(row);
    });
  }

  // âœ… Ø¹Ø¯Ø§Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ (10 Ø¯Ù‚Ø§Ø¦Ù‚)
  let totalTime = 600;
  function updateCountdown(){
    const minutes = Math.floor(totalTime/60);
    const seconds = totalTime%60;
    document.getElementById("countdown").innerText =
      "Ø§Ù„Ø¹Ø±Ø¶ ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„: " + minutes + ":" + (seconds<10 ? "0":"") + seconds;
    if(totalTime > 0) totalTime--;
  }

  // init
  async function init(){
    await Promise.all(prizes.map(p => loadImage(p.img)));
    renderPrizeList();
    drawWheel();
    setInterval(updateCountdown, 1000);
    updateCountdown();
  }

  spinBtn.addEventListener("click", spin);
  resetBtn.addEventListener("click", reset);
  closeBtn.addEventListener("click", closeModal);
  modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

  init();
</script>
</body>
</html>
